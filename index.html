<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine Inventory App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #000;
            color: #fff;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #333;
            padding-bottom: 1rem;
        }
        .title {
            font-size: 2rem;
            font-weight: bold;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-blue { background: #2563eb; color: white; }
        .btn-blue:hover { background: #1d4ed8; }
        .btn-green { background: #16a34a; color: white; }
        .btn-green:hover { background: #15803d; }
        .btn-purple { background: #9333ea; color: white; }
        .btn-purple:hover { background: #7e22ce; }
        .btn-red { background: #dc2626; color: white; }
        .btn-red:hover { background: #b91c1c; }
        .btn-gray { background: #4b5563; color: white; }
        .btn-gray:hover { background: #374151; }
        .card {
            background: #1a1a1a;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .input {
            width: 100%;
            padding: 0.75rem;
            background: #2a2a2a;
            border: none;
            border-radius: 0.5rem;
            color: white;
            font-size: 1rem;
        }
        .input:focus {
            outline: 2px solid #2563eb;
        }
        .label {
            display: block;
            color: #9ca3af;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        .grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th {
            background: #2a2a2a;
            padding: 1rem;
            text-align: left;
        }
        .table td {
            padding: 1rem;
            border-top: 1px solid #333;
        }
        .table tr:nth-child(even) {
            background: #1a1a1a;
        }
        video {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: block;
            border-radius: 0.5rem;
        }
        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .text-center {
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        .icon-btn {
            background: none;
            border: none;
            color: #dc2626;
            cursor: pointer;
            padding: 0.5rem;
            font-size: 1.2rem;
        }
        .icon-btn:hover {
            color: #b91c1c;
        }
        .empty-state {
            padding: 3rem;
            text-align: center;
            color: #6b7280;
        }
        .footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #333;
            text-align: center;
            color: #6b7280;
            font-size: 0.875rem;
        }
        img.preview {
            max-width: 500px;
            margin: 0 auto;
            display: block;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

```
    const MedicineInventoryApp = () => {
        const [medicines, setMedicines] = useState([]);
        const [currentImage, setCurrentImage] = useState(null);
        const [isProcessing, setIsProcessing] = useState(false);
        const [language, setLanguage] = useState('en');
        const [editingMedicine, setEditingMedicine] = useState(null);
        const fileInputRef = useRef(null);
        const videoRef = useRef(null);
        const canvasRef = useRef(null);
        const [isCameraActive, setIsCameraActive] = useState(false);
        const [stream, setStream] = useState(null);

        const translations = {
            en: {
                title: 'Medicine Inventory',
                capturePhoto: 'Capture Photo',
                uploadImage: 'Upload Image',
                processing: 'Processing...',
                name: 'Medicine Name',
                strength: 'Strength',
                quantity: 'Quantity',
                purpose: 'Purpose/Benefits',
                actions: 'Actions',
                exportCSV: 'Export CSV',
                shareEmail: 'Share Email',
                saveDevice: 'Save',
                noMedicines: 'No medicines added yet',
                startCamera: 'Start Camera',
                stopCamera: 'Stop Camera',
                takePhoto: 'Take Photo',
                addManually: 'Add Manually',
                delete: 'Delete',
                save: 'Save',
                cancel: 'Cancel',
                developedBy: 'Developed by Hassan 2026',
                version: 'Version 1.0.0'
            },
            ar: {
                title: 'ÿ¨ÿ±ÿØ ÿßŸÑÿ£ÿØŸàŸäÿ©',
                capturePhoto: 'ÿßŸÑÿ™ŸÇÿßÿ∑ ÿµŸàÿ±ÿ©',
                uploadImage: 'ÿ±ŸÅÿπ ÿµŸàÿ±ÿ©',
                processing: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...',
                name: 'ÿßÿ≥ŸÖ ÿßŸÑÿØŸàÿßÿ°',
                strength: 'ÿßŸÑŸÇŸàÿ©',
                quantity: 'ÿßŸÑŸÉŸÖŸäÿ©',
                purpose: 'ÿßŸÑŸÅÿßÿ¶ÿØÿ©',
                actions: 'ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™',
                exportCSV: 'ÿ™ÿµÿØŸäÿ± CSV',
                shareEmail: 'ŸÖÿ¥ÿßÿ±ŸÉÿ©',
                saveDevice: 'ÿ≠ŸÅÿ∏',
                noMedicines: 'ŸÑŸÖ ÿ™ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿØŸàŸäÿ©',
                startCamera: 'ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß',
                stopCamera: 'ÿ•ŸäŸÇÿßŸÅ',
                takePhoto: 'ÿßŸÑÿ™ŸÇÿßÿ∑',
                addManually: 'ÿ•ÿ∂ÿßŸÅÿ© ŸäÿØŸàŸäÿ©',
                delete: 'ÿ≠ÿ∞ŸÅ',
                save: 'ÿ≠ŸÅÿ∏',
                cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
                developedBy: 'ÿ™ÿ∑ŸàŸäÿ± ÿ≠ÿ≥ŸÜ Ÿ¢Ÿ†Ÿ¢Ÿ¶',
                version: 'ÿ•ÿµÿØÿßÿ± 1.0.0'
            }
        };

        const t = translations[language];

        useEffect(() => {
            const savedData = localStorage.getItem('medicineInventory');
            if (savedData) {
                try {
                    setMedicines(JSON.parse(savedData));
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }, []);

        useEffect(() => {
            if (medicines.length > 0) {
                localStorage.setItem('medicineInventory', JSON.stringify(medicines));
            }
        }, [medicines]);

        const startCamera = async () => {
            try {
                const mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                if (videoRef.current) {
                    videoRef.current.srcObject = mediaStream;
                }
                setStream(mediaStream);
                setIsCameraActive(true);
            } catch (err) {
                console.error('Camera error:', err);
                alert('Cannot access camera. Please use Upload Image instead.');
            }
        };

        const stopCamera = () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            setIsCameraActive(false);
            setStream(null);
        };

        const capturePhoto = () => {
            if (videoRef.current && canvasRef.current) {
                const context = canvasRef.current.getContext('2d');
                canvasRef.current.width = videoRef.current.videoWidth;
                canvasRef.current.height = videoRef.current.videoHeight;
                context.drawImage(videoRef.current, 0, 0);
                const imageDataUrl = canvasRef.current.toDataURL('image/jpeg');
                setCurrentImage(imageDataUrl);
                stopCamera();
                setTimeout(() => processImage(imageDataUrl), 500);
            }
        };

        const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    setCurrentImage(event.target.result);
                    setTimeout(() => processImage(event.target.result), 500);
                };
                reader.readAsDataURL(file);
            }
        };

        const processImage = async (imageData) => {
            if (!imageData) return;
            
            setIsProcessing(true);
            
            try {
                const result = await Tesseract.recognize(imageData, 'eng+ara', {
                    logger: info => console.log(info)
                });

                const text = result.data.text;
                console.log('OCR Text:', text);
                
                const extracted = extractInfo(text);
                
                setEditingMedicine({
                    id: Date.now(),
                    ...extracted,
                    image: imageData
                });
                
            } catch (error) {
                console.error('OCR Error:', error);
                setEditingMedicine({
                    id: Date.now(),
                    name: '',
                    strength: '',
                    quantity: '',
                    purpose: '',
                    image: imageData
                });
            } finally {
                setIsProcessing(false);
            }
        };

        const extractInfo = (text) => {
            if (!text) return { name: '', strength: '', quantity: '', purpose: '' };
            
            const lines = text.split('\n').filter(line => line.trim());
            
            const strengthMatch = text.match(/(\d+(?:\.\d+)?)\s*(mg|ml|mcg|g|iu|IU)/gi);
            const quantityMatch = text.match(/(\d+)\s*(tablet|capsule|pill|piece|count|tabs|caps|ŸÇÿ±ÿµ|ŸÉÿ®ÿ≥ŸàŸÑÿ©|ÿ≠ÿ®ÿ©)/gi);
            
            let name = lines.length > 0 ? lines[0].substring(0, 50) : '';
            let strength = strengthMatch ? strengthMatch.map(s => s.trim()).join(', ').substring(0, 50) : '';
            let quantity = quantityMatch ? quantityMatch[0] : '';
            
            const purposeKeywords = ['for', 'treatment', 'vitamin', 'supplement', 'relief', 'pain'];
            let purpose = '';
            for (const line of lines) {
                if (purposeKeywords.some(k => line.toLowerCase().includes(k))) {
                    purpose = line.substring(0, 100);
                    break;
                }
            }
            
            return { name, strength, quantity, purpose };
        };

        const saveMedicine = () => {
            if (editingMedicine) {
                const existingIndex = medicines.findIndex(m => m.id === editingMedicine.id);
                if (existingIndex >= 0) {
                    const updated = [...medicines];
                    updated[existingIndex] = editingMedicine;
                    setMedicines(updated);
                } else {
                    setMedicines([...medicines, editingMedicine]);
                }
                setEditingMedicine(null);
                setCurrentImage(null);
            }
        };

        const deleteMedicine = (id) => {
            setMedicines(medicines.filter(m => m.id !== id));
        };

        const exportToCSV = () => {
            const headers = ['Medicine Name', 'Strength', 'Quantity', 'Purpose'];
            const csv = [
                headers.join(','),
                ...medicines.map(m => `"${m.name}","${m.strength}","${m.quantity}","${m.purpose}"`)
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'medicine_inventory.csv';
            link.click();
        };

        const shareViaEmail = () => {
            const body = medicines.map(m => 
                `${m.name} - ${m.strength} - Qty: ${m.quantity}`
            ).join('\n');
            
            window.location.href = `mailto:?subject=Medicine Inventory&body=${encodeURIComponent(body)}`;
        };

        return (
            <div className="container" dir={language === 'ar' ? 'rtl' : 'ltr'}>
                <div className="header">
                    <h1 className="title">{t.title}</h1>
                    <button
                        onClick={() => setLanguage(language === 'en' ? 'ar' : 'en')}
                        className="btn btn-gray"
                    >
                        üåê {language === 'en' ? 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'English'}
                    </button>
                </div>

                <div className="card">
                    {!currentImage && !isCameraActive && (
                        <div className="flex-center">
                            <button onClick={startCamera} className="btn btn-blue">
                                üì∑ {t.startCamera}
                            </button>
                            <label className="btn btn-green">
                                üì§ {t.uploadImage}
                                <input
                                    ref={fileInputRef}
                                    type="file"
                                    accept="image/*"
                                    onChange={handleFileUpload}
                                    className="hidden"
                                />
                            </label>
                            <button
                                onClick={() => setEditingMedicine({
                                    id: Date.now(),
                                    name: '', strength: '', quantity: '', purpose: ''
                                })}
                                className="btn btn-purple"
                            >
                                ‚ûï {t.addManually}
                            </button>
                        </div>
                    )}

                    {isCameraActive && (
                        <div>
                            <video ref={videoRef} autoPlay playsInline />
                            <div className="flex-center" style={{marginTop: '1rem'}}>
                                <button onClick={capturePhoto} className="btn btn-blue">
                                    {t.takePhoto}
                                </button>
                                <button onClick={stopCamera} className="btn btn-red">
                                    {t.stopCamera}
                                </button>
                            </div>
                        </div>
                    )}

                    {currentImage && !editingMedicine && isProcessing && (
                        <div className="text-center">
                            <img src={currentImage} alt="Processing" className="preview" style={{opacity: 0.5, marginBottom: '1rem'}} />
                            <div className="spinner"></div>
                            <p style={{marginTop: '1rem'}}>{t.processing}</p>
                        </div>
                    )}

                    <canvas ref={canvasRef} className="hidden" />
                </div>

                {editingMedicine && (
                    <div className="card">
                        <div className="grid">
                            <div>
                                <label className="label">{t.name}</label>
                                <input
                                    type="text"
                                    value={editingMedicine.name}
                                    onChange={(e) => setEditingMedicine({...editingMedicine, name: e.target.value})}
                                    className="input"
                                />
                            </div>
                            <div>
                                <label className="label">{t.strength}</label>
                                <input
                                    type="text"
                                    value={editingMedicine.strength}
                                    onChange={(e) => setEditingMedicine({...editingMedicine, strength: e.target.value})}
                                    className="input"
                                />
                            </div>
                            <div>
                                <label className="label">{t.quantity}</label>
                                <input
                                    type="text"
                                    value={editingMedicine.quantity}
                                    onChange={(e) => setEditingMedicine({...editingMedicine, quantity: e.target.value})}
                                    className="input"
                                />
                            </div>
                            <div>
                                <label className="label">{t.purpose}</label>
                                <input
                                    type="text"
                                    value={editingMedicine.purpose}
                                    onChange={(e) => setEditingMedicine({...editingMedicine, purpose: e.target.value})}
                                    className="input"
                                />
                            </div>
                        </div>
                        <div className="flex-center" style={{marginTop: '1.5rem'}}>
                            <button onClick={saveMedicine} className="btn btn-green">
                                {t.save}
                            </button>
                            <button
                                onClick={() => {
                                    setEditingMedicine(null);
                                    setCurrentImage(null);
                                }}
                                className="btn btn-gray"
                            >
                                {t.cancel}
                            </button>
                        </div>
                    </div>
                )}

                {medicines.length > 0 && (
                    <div className="flex-center" style={{marginBottom: '2rem'}}>
                        <button onClick={exportToCSV} className="btn btn-green">
                            üíæ {t.exportCSV}
                        </button>
                        <button onClick={shareViaEmail} className="btn btn-blue">
                            ‚úâÔ∏è {t.shareEmail}
                        </button>
                    </div>
                )}

                <div className="card">
                    {medicines.length > 0 ? (
                        <div style={{overflowX: 'auto'}}>
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>{t.name}</th>
                                        <th>{t.strength}</th>
                                        <th>{t.quantity}</th>
                                        <th>{t.purpose}</th>
                                        <th>{t.actions}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {medicines.map((med) => (
                                        <tr key={med.id}>
                                            <td>{med.name}</td>
                                            <td>{med.strength}</td>
                                            <td>{med.quantity}</td>
                                            <td>{med.purpose}</td>
                                            <td>
                                                <button
                                                    onClick={() => deleteMedicine(med.id)}
                                                    className="icon-btn"
                                                >
                                                    üóëÔ∏è
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div style={{fontSize: '3rem'}}>üìã</div>
                            <p>{t.noMedicines}</p>
                        </div>
                    )}
                </div>

                <div className="footer">
                    <p>{t.version}</p>
                    <p>{t.developedBy}</p>
                </div>
            </div>
        );
    };

    ReactDOM.render(<MedicineInventoryApp />, document.getElementById('root'));
</script>
```

</body>
</html>

<!DOCTYPE html>

<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø±Ø¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© | Medicine Inventory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        direction: rtl;
    }
    
    .container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .title {
        font-size: 24px;
        color: #667eea;
        font-weight: bold;
    }
    
    .lang-btn {
        padding: 10px 20px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
        font-weight: 600;
    }
    
    .btn-primary {
        background: #667eea;
        color: white;
    }
    
    .btn-success {
        background: #48bb78;
        color: white;
    }
    
    .btn-danger {
        background: #f56565;
        color: white;
    }
    
    .btn-secondary {
        background: #718096;
        color: white;
    }
    
    .btn-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    
    .input-group {
        margin-bottom: 15px;
    }
    
    label {
        display: block;
        margin-bottom: 5px;
        color: #4a5568;
        font-weight: 600;
    }
    
    input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 16px;
    }
    
    input:focus {
        outline: none;
        border-color: #667eea;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    th, td {
        padding: 12px;
        text-align: right;
        border-bottom: 1px solid #e2e8f0;
    }
    
    th {
        background: #f7fafc;
        font-weight: bold;
        color: #2d3748;
    }
    
    .empty-state {
        text-align: center;
        padding: 40px;
        color: #a0aec0;
    }
    
    .empty-icon {
        font-size: 64px;
        margin-bottom: 10px;
    }
    
    .hidden {
        display: none;
    }
    
    video {
        width: 100%;
        max-width: 400px;
        border-radius: 8px;
        margin: 10px auto;
        display: block;
    }
    
    img.preview {
        max-width: 100%;
        border-radius: 8px;
        margin: 10px 0;
    }
    
    .processing {
        text-align: center;
        padding: 20px;
    }
    
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .footer {
        text-align: center;
        color: white;
        margin-top: 30px;
        padding: 20px;
    }
    
    @media (max-width: 600px) {
        body {
            padding: 10px;
        }
        
        .title {
            font-size: 18px;
        }
        
        .btn {
            padding: 10px 16px;
            font-size: 14px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="title" id="pageTitle">Ø¬Ø±Ø¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©</div>
            <button class="lang-btn" onclick="toggleLanguage()" id="langBtn">English</button>
        </div>

```
    <!-- Upload Section -->
    <div class="card" id="uploadSection">
        <div class="btn-container">
            <button class="btn btn-primary" onclick="startCamera()">
                <span id="cameraBtn">ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</span>
            </button>
            <label class="btn btn-success">
                <span id="uploadBtn">ğŸ“¤ Ø±ÙØ¹ ØµÙˆØ±Ø©</span>
                <input type="file" accept="image/*" onchange="handleFileUpload(event)" style="display: none;">
            </label>
            <button class="btn btn-secondary" onclick="showManualForm()">
                <span id="manualBtn">âœï¸ Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©</span>
            </button>
        </div>
    </div>
    
    <!-- Camera Section -->
    <div class="card hidden" id="cameraSection">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas" class="hidden"></canvas>
        <div class="btn-container">
            <button class="btn btn-primary" onclick="capturePhoto()">
                <span id="captureBtn">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©</span>
            </button>
            <button class="btn btn-danger" onclick="stopCamera()">
                <span id="stopBtn">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</span>
            </button>
        </div>
    </div>
    
    <!-- Processing -->
    <div class="card hidden" id="processingSection">
        <div class="processing">
            <img id="previewImage" class="preview">
            <div class="spinner"></div>
            <p id="processingText">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...</p>
        </div>
    </div>
    
    <!-- Edit Form -->
    <div class="card hidden" id="editForm">
        <h3 style="margin-bottom: 20px; color: #667eea;" id="formTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡</h3>
        <div class="input-group">
            <label id="nameLabel">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡</label>
            <input type="text" id="medicineName">
        </div>
        <div class="input-group">
            <label id="strengthLabel">Ø§Ù„Ù‚ÙˆØ©</label>
            <input type="text" id="medicineStrength">
        </div>
        <div class="input-group">
            <label id="quantityLabel">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
            <input type="text" id="medicineQuantity">
        </div>
        <div class="input-group">
            <label id="purposeLabel">Ø§Ù„ÙØ§Ø¦Ø¯Ø©/Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
            <input type="text" id="medicinePurpose">
        </div>
        <div class="btn-container">
            <button class="btn btn-success" onclick="saveMedicine()">
                <span id="saveBtn">ğŸ’¾ Ø­ÙØ¸</span>
            </button>
            <button class="btn btn-secondary" onclick="cancelEdit()">
                <span id="cancelBtn">âŒ Ø¥Ù„ØºØ§Ø¡</span>
            </button>
        </div>
    </div>
    
    <!-- Export Buttons -->
    <div class="card hidden" id="exportSection">
        <div class="btn-container">
            <button class="btn btn-success" onclick="exportToCSV()">
                <span id="exportBtn">ğŸ“Š ØªØµØ¯ÙŠØ± CSV</span>
            </button>
            <button class="btn btn-primary" onclick="shareEmail()">
                <span id="emailBtn">âœ‰ï¸ Ù…Ø´Ø§Ø±ÙƒØ©</span>
            </button>
        </div>
    </div>
    
    <!-- Table -->
    <div class="card">
        <div id="medicineTable"></div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <p>ØªØ·ÙˆÙŠØ± Ø­Ø³Ù† Ù¢Ù Ù¢Ù¦ | Version 1.0</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
    let medicines = [];
    let currentStream = null;
    let currentLanguage = 'ar';
    let editingId = null;
    
    // Translations
    const translations = {
        ar: {
            pageTitle: 'Ø¬Ø±Ø¯ Ø§Ù„Ø£Ø¯ÙˆÙŠØ©',
            langBtn: 'English',
            cameraBtn: 'ğŸ“· ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§',
            uploadBtn: 'ğŸ“¤ Ø±ÙØ¹ ØµÙˆØ±Ø©',
            manualBtn: 'âœï¸ Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©',
            captureBtn: 'ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø©',
            stopBtn: 'â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù',
            processingText: 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...',
            formTitle: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡',
            nameLabel: 'Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡',
            strengthLabel: 'Ø§Ù„Ù‚ÙˆØ©',
            quantityLabel: 'Ø§Ù„ÙƒÙ…ÙŠØ©',
            purposeLabel: 'Ø§Ù„ÙØ§Ø¦Ø¯Ø©/Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…',
            saveBtn: 'ğŸ’¾ Ø­ÙØ¸',
            cancelBtn: 'âŒ Ø¥Ù„ØºØ§Ø¡',
            exportBtn: 'ğŸ“Š ØªØµØ¯ÙŠØ± CSV',
            emailBtn: 'âœ‰ï¸ Ù…Ø´Ø§Ø±ÙƒØ©',
            thName: 'Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡',
            thStrength: 'Ø§Ù„Ù‚ÙˆØ©',
            thQuantity: 'Ø§Ù„ÙƒÙ…ÙŠØ©',
            thPurpose: 'Ø§Ù„ÙØ§Ø¦Ø¯Ø©',
            thActions: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',
            emptyState: 'Ù„Ù… ØªØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆÙŠØ© Ø¨Ø¹Ø¯'
        },
        en: {
            pageTitle: 'Medicine Inventory',
            langBtn: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
            cameraBtn: 'ğŸ“· Start Camera',
            uploadBtn: 'ğŸ“¤ Upload Image',
            manualBtn: 'âœï¸ Add Manually',
            captureBtn: 'ğŸ“¸ Take Photo',
            stopBtn: 'â¹ï¸ Stop',
            processingText: 'Processing image...',
            formTitle: 'Medicine Details',
            nameLabel: 'Medicine Name',
            strengthLabel: 'Strength',
            quantityLabel: 'Quantity',
            purposeLabel: 'Purpose/Benefits',
            saveBtn: 'ğŸ’¾ Save',
            cancelBtn: 'âŒ Cancel',
            exportBtn: 'ğŸ“Š Export CSV',
            emailBtn: 'âœ‰ï¸ Share',
            thName: 'Name',
            thStrength: 'Strength',
            thQuantity: 'Quantity',
            thPurpose: 'Purpose',
            thActions: 'Actions',
            emptyState: 'No medicines added yet'
        }
    };
    
    // Load saved data
    function loadData() {
        const saved = localStorage.getItem('medicines');
        if (saved) {
            medicines = JSON.parse(saved);
            updateTable();
        }
    }
    
    // Save data
    function saveData() {
        localStorage.setItem('medicines', JSON.stringify(medicines));
    }
    
    // Toggle language
    function toggleLanguage() {
        currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
        document.body.style.direction = currentLanguage === 'ar' ? 'rtl' : 'ltr';
        updateUI();
    }
    
    // Update UI text
    function updateUI() {
        const t = translations[currentLanguage];
        document.getElementById('pageTitle').textContent = t.pageTitle;
        document.getElementById('langBtn').textContent = t.langBtn;
        document.getElementById('cameraBtn').textContent = t.cameraBtn;
        document.getElementById('uploadBtn').textContent = t.uploadBtn;
        document.getElementById('manualBtn').textContent = t.manualBtn;
        document.getElementById('captureBtn').textContent = t.captureBtn;
        document.getElementById('stopBtn').textContent = t.stopBtn;
        document.getElementById('processingText').textContent = t.processingText;
        document.getElementById('formTitle').textContent = t.formTitle;
        document.getElementById('nameLabel').textContent = t.nameLabel;
        document.getElementById('strengthLabel').textContent = t.strengthLabel;
        document.getElementById('quantityLabel').textContent = t.quantityLabel;
        document.getElementById('purposeLabel').textContent = t.purposeLabel;
        document.getElementById('saveBtn').textContent = t.saveBtn;
        document.getElementById('cancelBtn').textContent = t.cancelBtn;
        document.getElementById('exportBtn').textContent = t.exportBtn;
        document.getElementById('emailBtn').textContent = t.emailBtn;
        updateTable();
    }
    
    // Start camera
    async function startCamera() {
        try {
            currentStream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } 
            });
            document.getElementById('video').srcObject = currentStream;
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('cameraSection').classList.remove('hidden');
        } catch (err) {
            alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§. Ø§Ø³ØªØ®Ø¯Ù… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ.');
        }
    }
    
    // Stop camera
    function stopCamera() {
        if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
        }
        document.getElementById('cameraSection').classList.add('hidden');
        document.getElementById('uploadSection').classList.remove('hidden');
    }
    
    // Capture photo
    function capturePhoto() {
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        const imageData = canvas.toDataURL('image/jpeg');
        stopCamera();
        processImage(imageData);
    }
    
    // Handle file upload
    function handleFileUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => processImage(e.target.result);
            reader.readAsDataURL(file);
        }
    }
    
    // Preprocess image for better OCR
    function preprocessImage(imageData) {
        return new Promise((resolve) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw image
                ctx.drawImage(img, 0, 0);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Convert to grayscale and increase contrast
                for (let i = 0; i < data.length; i += 4) {
                    const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                    // Increase contrast
                    const contrast = 1.5;
                    const adjusted = ((gray - 128) * contrast) + 128;
                    const value = Math.max(0, Math.min(255, adjusted));
                    
                    data[i] = data[i + 1] = data[i + 2] = value;
                }
                
                ctx.putImageData(imageData, 0, 0);
                resolve(canvas.toDataURL('image/jpeg'));
            };
            img.src = imageData;
        });
    }

    // Process image with OCR
    async function processImage(imageData) {
        document.getElementById('uploadSection').classList.add('hidden');
        document.getElementById('processingSection').classList.remove('hidden');
        document.getElementById('previewImage').src = imageData;
        
        try {
            // Preprocess image for better OCR
            const processedImage = await preprocessImage(imageData);
            
            // Run OCR with better settings
            const result = await Tesseract.recognize(processedImage, 'eng+ara', {
                logger: info => console.log(info),
                tessedit_pageseg_mode: Tesseract.PSM.AUTO,
                preserve_interword_spaces: '1'
            });
            
            const text = result.data.text;
            console.log('Full OCR Text:\n', text);
            
            const extracted = extractInfo(text);
            showEditForm(extracted);
        } catch (err) {
            console.error('OCR Error:', err);
            showEditForm({name: '', strength: '', quantity: '', purpose: ''});
        }
        
        document.getElementById('processingSection').classList.add('hidden');
    }
    
    // Extract info from OCR text - Advanced
    function extractInfo(text) {
        console.log('Analyzing text...');
        
        // Clean and normalize text
        const cleanText = text.replace(/[^\w\s\d.,-]/gi, ' ').replace(/\s+/g, ' ');
        const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 1);
        
        console.log('Clean lines:', lines);
        
        // === Extract STRENGTH ===
        let strength = '';
        // Pattern 1: Number followed by unit (350 mg, 1000 IU, etc)
        const strengthPatterns = [
            /(\d+[\.,]?\d*)\s*(mg|milligram|milligrams)/gi,
            /(\d+[\.,]?\d*)\s*(mcg|microgram|micrograms|Î¼g|Âµg)/gi,
            /(\d+[\.,]?\d*)\s*(g|gram|grams)/gi,
            /(\d+[\.,]?\d*)\s*(ml|milliliter|milliliters)/gi,
            /(\d+[\.,]?\d*)\s*(iu|IU|units?)/gi,
            /(\d{2,4})\s*(?=\s|$)/g  // Large numbers alone (like 350, 1000)
        ];
        
        for (const pattern of strengthPatterns) {
            const matches = text.match(pattern);
            if (matches) {
                // Filter out dates and irrelevant numbers
                const filtered = matches.filter(m => {
                    const num = parseInt(m);
                    return num >= 10 && num <= 10000;
                });
                if (filtered.length > 0) {
                    strength = filtered[0].trim();
                    // Add 'mg' if just a number
                    if (!/[a-zA-Z]/.test(strength)) {
                        strength += ' mg';
                    }
                    break;
                }
            }
        }
        
        // === Extract QUANTITY ===
        let quantity = '';
        const quantityPatterns = [
            /(\d+)\s*(tablets?|caps?|capsules?|pills?|vegcaps?|softgels?|gummies|counts?|pieces?)/gi,
            /(\d+)\s*(Ù‚Ø±Øµ|ÙƒØ¨Ø³ÙˆÙ„Ø©|Ø­Ø¨Ø©|Ù‚Ø·Ø¹Ø©)/gi
        ];
        
        for (const pattern of quantityPatterns) {
            const match = text.match(pattern);
            if (match) {
                quantity = match[0].trim();
                break;
            }
        }
        
        // === Extract NAME ===
        let name = '';
        const nameKeywords = ['magnesium', 'calcium', 'vitamin', 'zinc', 'iron', 'omega', 'glucosamine', 
                             'probiotic', 'collagen', 'biotin', 'coq10', 'turmeric', 'ginseng'];
        
        // Look for brand name or product name
        for (const line of lines) {
            const lower = line.toLowerCase();
            
            // Skip lines that are clearly not names
            if (line.length < 3 || /^\d+$/.test(line)) continue;
            if (/since|trust|quality|dietary|supplement|verified/i.test(line)) continue;
            
            // Check if line contains supplement keywords
            const hasKeyword = nameKeywords.some(kw => lower.includes(kw));
            
            // Priority 1: Lines with supplement keywords
            if (hasKeyword && line.length >= 5) {
                name = line;
                break;
            }
            
            // Priority 2: Lines with brand-like structure (capital letters, 2-4 words)
            if (!name && /^[A-Z]/.test(line) && line.split(' ').length >= 2 && line.split(' ').length <= 5) {
                const words = line.split(' ');
                // Check if it's likely a product name
                const hasNumbers = /\d/.test(line);
                const hasLetters = /[a-zA-Z]{3,}/.test(line);
                if (hasLetters && line.length <= 50) {
                    name = line;
                }
            }
        }
        
        // Fallback: use first substantial line
        if (!name) {
            for (const line of lines) {
                if (line.length >= 5 && /[a-zA-Z]{3,}/.test(line)) {
                    name = line;
                    break;
                }
            }
        }
        
        // Clean name: remove common non-name words
        if (name) {
            name = name.replace(/(high absorption|fully chelated|non-gmo|verified|dietary supplement)/gi, '').trim();
        }
        
        // === Extract PURPOSE ===
        let purpose = '';
        const purposeKeywords = [
            'support', 'relaxation', 'immune', 'energy', 'health', 'bone', 'muscle',
            'joint', 'heart', 'brain', 'mood', 'sleep', 'stress', 'digestion',
            'antioxidant', 'anti-inflammatory', 'wellness', 'vitality', 'strength'
        ];
        
        for (const line of lines) {
            const lower = line.toLowerCase();
            const matchCount = purposeKeywords.filter(kw => lower.includes(kw)).length;
            
            if (matchCount > 0) {
                purpose = line;
                break;
            }
        }
        
        // Build complete name with strength if found
        if (name && strength && !name.includes(strength.replace(/\s*mg\s*/i, ''))) {
            const strengthNum = strength.match(/\d+/);
            if (strengthNum && !name.includes(strengthNum[0])) {
                // Don't add if name already seems complete
                if (name.split(' ').length < 4) {
                    name = `${name} ${strength.replace(/\s*mg\s*/i, '')}`;
                }
            }
        }
        
        const result = {
            name: name.substring(0, 50).trim(),
            strength: strength.substring(0, 30).trim(),
            quantity: quantity.trim(),
            purpose: purpose.substring(0, 100).trim()
        };
        
        console.log('Extracted Result:', result);
        return result;
    }
    
    // Show manual form
    function showManualForm() {
        showEditForm({name: '', strength: '', quantity: '', purpose: ''});
    }
    
    // Show edit form
    function showEditForm(data) {
        editingId = Date.now();
        document.getElementById('medicineName').value = data.name;
        document.getElementById('medicineStrength').value = data.strength;
        document.getElementById('medicineQuantity').value = data.quantity;
        document.getElementById('medicinePurpose').value = data.purpose;
        document.getElementById('uploadSection').classList.add('hidden');
        document.getElementById('editForm').classList.remove('hidden');
    }
    
    // Save medicine
    function saveMedicine() {
        const medicine = {
            id: editingId,
            name: document.getElementById('medicineName').value,
            strength: document.getElementById('medicineStrength').value,
            quantity: document.getElementById('medicineQuantity').value,
            purpose: document.getElementById('medicinePurpose').value
        };
        
        medicines.push(medicine);
        saveData();
        updateTable();
        cancelEdit();
    }
    
    // Cancel edit
    function cancelEdit() {
        document.getElementById('editForm').classList.add('hidden');
        document.getElementById('uploadSection').classList.remove('hidden');
        editingId = null;
    }
    
    // Delete medicine
    function deleteMedicine(id) {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ØŸ')) {
            medicines = medicines.filter(m => m.id !== id);
            saveData();
            updateTable();
        }
    }
    
    // Update table
    function updateTable() {
        const t = translations[currentLanguage];
        const tableDiv = document.getElementById('medicineTable');
        
        if (medicines.length === 0) {
            tableDiv.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“‹</div>
                    <p>${t.emptyState}</p>
                </div>
            `;
            document.getElementById('exportSection').classList.add('hidden');
        } else {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>${t.thName}</th>
                            <th>${t.thStrength}</th>
                            <th>${t.thQuantity}</th>
                            <th>${t.thPurpose}</th>
                            <th>${t.thActions}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            medicines.forEach(med => {
                html += `
                    <tr>
                        <td>${med.name}</td>
                        <td>${med.strength}</td>
                        <td>${med.quantity}</td>
                        <td>${med.purpose}</td>
                        <td>
                            <button onclick="deleteMedicine(${med.id})" style="background: none; border: none; cursor: pointer; font-size: 20px;">
                                ğŸ—‘ï¸
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            tableDiv.innerHTML = html;
            document.getElementById('exportSection').classList.remove('hidden');
        }
    }
    
    // Export to CSV
    function exportToCSV() {
        let csv = 'Medicine Name,Strength,Quantity,Purpose\n';
        medicines.forEach(m => {
            csv += `"${m.name}","${m.strength}","${m.quantity}","${m.purpose}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'medicine_inventory.csv';
        a.click();
    }
    
    // Share via email
    function shareEmail() {
        const body = medicines.map(m => 
            `${m.name} - ${m.strength} - ${m.quantity}`
        ).join('\n');
        
        window.location.href = `mailto:?subject=Medicine Inventory&body=${encodeURIComponent(body)}`;
    }
    
    // Initialize
    loadData();
    updateUI();
</script>
```

</body>
</html>
